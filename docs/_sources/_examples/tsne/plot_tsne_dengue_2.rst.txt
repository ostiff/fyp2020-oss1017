
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "_examples/tsne/plot_tsne_dengue_2.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download__examples_tsne_plot_tsne_dengue_2.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr__examples_tsne_plot_tsne_dengue_2.py:


t-SNE: Dengue dataset 2
============================

Training attributes: `age`, `gender`, `weight`, `plt`, `haematocrit_percent`,
  `body_temperature`.

Attributes used in cluster comparison: `bleeding`, `shock`, `bleeding_gum`,
 `abdominal_pain`, `ascites`, `bleeding_mucosal`, `bleeding_skin`.

.. GENERATED FROM PYTHON SOURCE LINES 12-27

.. code-block:: default
   :lineno-start: 12

    # Libraries
    import pandas as pd
    import numpy as np
    from sklearn.manifold import TSNE
    from sklearn.cluster import DBSCAN
    from sklearn import preprocessing
    import matplotlib.pyplot as plt

    from pkgname.utils.data_loader import load_dengue
    pd.set_option('display.max_columns', None)


    SEED = 0
    np.random.seed(SEED)








.. GENERATED FROM PYTHON SOURCE LINES 28-35

Dataset
--------

Load dengue dataset. Perform forward and backwards fill after grouping by patient.
Does not make use of the `d001` dataset because it does not contain: `abdominal_pain`,
`bleeding_mucosal`, `bleeding_skin`, `body_temperature`.
To reduce computation time aggregate patient data to only have one tuple per patient.

.. GENERATED FROM PYTHON SOURCE LINES 35-68

.. code-block:: default
   :lineno-start: 36


    df = load_dengue(usedefault=True)

    mapping = {'Female': 1, 'Male': 2}
    df = df.replace({'gender': mapping})

    features = ["date", "age", "gender", "weight", "bleeding", "plt",
                "shock", "haematocrit_percent", "bleeding_gum", "abdominal_pain",
                "ascites", "bleeding_mucosal", "bleeding_skin", "body_temperature"]

    for feat in features:
        df[feat] = df.groupby('study_no')[feat].ffill().bfill()

    df = df.loc[df['age'] <= 18]
    #df = df.dropna()

    df = df.groupby(by="study_no", dropna=False).agg(
        date=pd.NamedAgg(column="date", aggfunc="last"),
        age=pd.NamedAgg(column="age", aggfunc="max"),
        gender=pd.NamedAgg(column="gender", aggfunc="first"),
        weight=pd.NamedAgg(column="weight", aggfunc=np.mean),
        bleeding=pd.NamedAgg(column="bleeding", aggfunc="max"),
        plt=pd.NamedAgg(column="plt", aggfunc="max"),
        shock=pd.NamedAgg(column="shock", aggfunc="max"),
        haematocrit_percent=pd.NamedAgg(column="haematocrit_percent", aggfunc="max"),
        bleeding_gum=pd.NamedAgg(column="bleeding_gum", aggfunc="max"),
        abdominal_pain=pd.NamedAgg(column="abdominal_pain", aggfunc="max"),
        ascites=pd.NamedAgg(column="ascites", aggfunc="max"),
        bleeding_mucosal=pd.NamedAgg(column="bleeding_mucosal", aggfunc="max"),
        bleeding_skin=pd.NamedAgg(column="bleeding_skin", aggfunc="max"),
        body_temperature=pd.NamedAgg(column="body_temperature", aggfunc=np.mean),
    ).dropna()
    print("len", len(df.index))




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    len 15036




.. GENERATED FROM PYTHON SOURCE LINES 69-73

t-SNE
--------

Use t-SNE on the z-score scaled data.

.. GENERATED FROM PYTHON SOURCE LINES 73-86

.. code-block:: default
   :lineno-start: 74


    info_feat = ["shock", "bleeding", "bleeding_gum", "abdominal_pain", "ascites",
               "bleeding_mucosal", "bleeding_skin", ]
    info_df = df[info_feat]

    data_feat = ["age", "weight", "plt", "haematocrit_percent", "body_temperature"]
    data_df = df[data_feat]

    scaler = preprocessing.StandardScaler()
    x = scaler.fit_transform(data_df.values)

    X_embedded = TSNE(n_components=2, perplexity=500, random_state=SEED).fit_transform(x)








.. GENERATED FROM PYTHON SOURCE LINES 87-91

DBSCAN
--------

Identify clusters using DBSCAN

.. GENERATED FROM PYTHON SOURCE LINES 91-94

.. code-block:: default
   :lineno-start: 92


    clustering = DBSCAN(eps=10, min_samples=5).fit(X_embedded)








.. GENERATED FROM PYTHON SOURCE LINES 95-97

Plotting
--------

.. GENERATED FROM PYTHON SOURCE LINES 97-122

.. code-block:: default
   :lineno-start: 98


    plt.scatter(X_embedded[:,0], X_embedded[:,1], c=clustering.labels_)
    plt.title('t-SNE + DBSCAN')
    plt.show()


    info_df['cluster'] = clustering.labels_

    _, ax1 = plt.subplots(len(info_feat), 1, figsize=(5, 5 * len(info_feat)))

    for i, feat in enumerate(info_feat):
        info_df.boxplot(feat,'cluster', ax=ax1[i], showmeans=True)

    plt.show()



    data_df['cluster'] = clustering.labels_

    _, ax1 = plt.subplots(len(data_feat), 1, figsize=(5, 5 * len(data_feat)))

    for i, feat in enumerate(data_feat):
        data_df.boxplot(feat,'cluster', ax=ax1[i], showmeans=True)

    plt.show()



.. rst-class:: sphx-glr-horizontal


    *

      .. image:: /_examples/tsne/images/sphx_glr_plot_tsne_dengue_2_001.png
          :alt: t-SNE + DBSCAN
          :class: sphx-glr-multi-img

    *

      .. image:: /_examples/tsne/images/sphx_glr_plot_tsne_dengue_2_002.png
          :alt: Boxplot grouped by cluster, shock, bleeding, bleeding_gum, abdominal_pain, ascites, bleeding_mucosal, bleeding_skin
          :class: sphx-glr-multi-img

    *

      .. image:: /_examples/tsne/images/sphx_glr_plot_tsne_dengue_2_003.png
          :alt: Boxplot grouped by cluster, age, weight, plt, haematocrit_percent, body_temperature
          :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /homes/oss1017/Documents/fyp/fyp2020-oss1017/examples/tsne/plot_tsne_dengue_2.py:103: SettingWithCopyWarning:


    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead

    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

    /homes/oss1017/Documents/fyp/fyp2020-oss1017/examples/tsne/plot_tsne_dengue_2.py:114: SettingWithCopyWarning:


    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead

    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 2 minutes  15.086 seconds)


.. _sphx_glr_download__examples_tsne_plot_tsne_dengue_2.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_tsne_dengue_2.py <plot_tsne_dengue_2.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_tsne_dengue_2.ipynb <plot_tsne_dengue_2.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
