

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Trajectories &mdash; pkgname 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-rendered-html.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Seaborn (incomplete!)" href="plot_sns_categories_01.html" />
    <link rel="prev" title="Outcomes (numbers)" href="plot_mpl_outcomes_nmb.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pkgname
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p><span class="caption-text">Example Galleries</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../data_analysis/index.html">Dataset analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tsne/index.html">The manifold TSNE gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../som/index.html">The self-organising map gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoencoder/index.html">Auto-encoders for dimensionality reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other/index.html">Other DR techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../result_analysis/index.html">Result analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../report_figures/index.html">Dissertation figures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../report_figures/index.html#autoencoder-experiment-dissertation-figures">Autoencoder experiment dissertation figures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../report_figures/index.html#som-experiment-dissertation-figures">SOM experiment dissertation figures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../report_figures/index.html#t-sne-experiment-dissertation-figures">t-SNE experiment dissertation figures</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The visualizations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="_utils.html">Utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_examples_all.html">Kde</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_examples_hist2d.html">KDE - Outcomes</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_mpl_categories_01.html">Categories (exhaustive)</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_mpl_categories_02.html">Categories (Damien)</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_mpl_categories_cmp.html">Kde</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_mpl_outcomes_bool.html">Outcomes (boolean)</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_mpl_outcomes_nmb.html">Outcomes (numbers)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_sns_categories_01.html">Seaborn (incomplete!)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../widgets/index.html">The Widgets’ gallery</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pkgname</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">The visualizations</a> &raquo;</li>
        
      <li>Trajectories</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/_examples/visualization/plot_mpl_trajectories.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-visualization-plot-mpl-trajectories-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="trajectories">
<span id="sphx-glr-examples-visualization-plot-mpl-trajectories-py"></span><h1>Trajectories<a class="headerlink" href="#trajectories" title="Permalink to this headline">¶</a></h1>
<ul class="sphx-glr-horizontal">
<li><img alt="Severe (5029), Warning (6809), Mild (5609)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_001.png" />
</li>
<li><img alt="Patient 1105 (28 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_002.png" />
</li>
<li><img alt="Patient 2012 (17 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_003.png" />
</li>
<li><img alt="Patient 2013 (20 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_004.png" />
</li>
<li><img alt="Patient 2026 (24 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_005.png" />
</li>
<li><img alt="Patient 2103 (29 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_006.png" />
</li>
<li><img alt="Patient 2104 (22 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_007.png" />
</li>
<li><img alt="Patient 2110 (17 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_008.png" />
</li>
<li><img alt="Patient 2168 (16 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_009.png" />
</li>
<li><img alt="Patient 2203 (10 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_010.png" />
</li>
<li><img alt="Patient 2205 (13 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_011.png" />
</li>
<li><img alt="Patient 2206 (12 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_012.png" />
</li>
<li><img alt="Patient 2205 (13 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_013.png" />
</li>
<li><img alt="Patient 2217 (14 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_014.png" />
</li>
<li><img alt="Patient 2222 (8 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_015.png" />
</li>
<li><img alt="Patient 2209 (10 years)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_016.png" />
</li>
<li><img alt="2209 (84 yo), 2209 (39 yo), 2209 (30 yo), 2209 (40 yo), 2209 (55 yo), 2209 (49 yo), 2209 (78 yo), 2209 (64 yo), 2209 (56 yo), 2209 (45 yo), 2209 (53 yo), 2209 (66 yo), 2209 (41 yo), 2209 (57 yo), 2209 (69 yo)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_017.png" />
</li>
<li><img alt="2209 (28 yo), 2209 (66 yo), 2209 (46 yo), 2209 (70 yo), 2209 (45 yo), 2209 (79 yo), 2209 (41 yo), 2209 (71 yo), 2209 (40 yo), 2209 (66 yo), 2209 (43 yo), 2209 (62 yo), 2209 (25 yo), 2209 (28 yo), 2209 (22 yo)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_018.png" />
</li>
<li><img alt="2209 (21 yo), 2209 (20 yo), 2209 (23 yo), 2209 (33 yo), 2209 (16 yo), 2209 (17 yo), 2209 (30 yo), 2209 (37 yo), 2209 (17 yo), 2209 (20 yo), 2209 (47 yo), 2209 (30 yo), 2209 (52 yo), 2209 (41 yo), 2209 (40 yo)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_019.png" />
</li>
<li><img alt="2209 (29 yo), 2209 (39 yo), 2209 (27 yo), 2209 (31 yo), 2209 (30 yo), 2209 (16 yo), 2209 (20 yo), 2209 (24 yo), 2209 (30 yo), 2209 (18 yo), 2209 (24 yo), 2209 (41 yo), 2209 (21 yo), 2209 (23 yo), 2209 (17 yo)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_020.png" />
</li>
<li><img alt="2209 (25 yo), 2209 (41 yo), 2209 (39 yo), 2209 (29 yo), 2209 (22 yo), 2209 (57 yo), 2209 (44 yo), 2209 (31 yo), 2209 (17 yo), 2209 (35 yo), 2209 (17 yo), 2209 (46 yo), 2209 (27 yo), 2209 (20 yo), 2209 (40 yo)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_021.png" />
</li>
<li><img alt="2209 (22 yo), 2209 (42 yo), 2209 (20 yo), 2209 (21 yo), 2209 (36 yo), 2209 (35 yo), 2209 (63 yo), 2209 (29 yo), 2209 (25 yo), 2209 (33 yo), 2209 (20 yo), 2209 (19 yo), 2209 (32 yo), 2209 (30 yo), 2209 (16 yo)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_022.png" />
</li>
<li><img alt="2209 (28 yo), 2209 (22 yo), 2209 (17 yo), 2209 (26 yo), 2209 (38 yo), 2209 (19 yo), 2209 (16 yo), 2209 (23 yo), 2209 (28 yo), 2209 (51 yo), 2209 (33 yo), 2209 (31 yo), 2209 (36 yo), 2209 (27 yo), 2209 (58 yo)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_023.png" />
</li>
<li><img alt="2209 (28 yo), 2209 (32 yo), 2209 (29 yo), 2209 (26 yo), 2209 (30 yo), 2209 (30 yo), 2209 (44 yo), 2209 (23 yo), 2209 (16 yo), 2209 (36 yo), 2209 (36 yo), 2209 (40 yo), 2209 (9 yo), 2209 (13 yo), 2209 (10 yo)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_024.png" />
</li>
<li><img alt="2209 (13 yo), 2209 (13 yo), 2209 (12 yo), 2209 (12 yo), 2209 (10 yo), 2209 (10 yo), 2209 (9 yo), 2209 (11 yo), 2209 (11 yo), 2209 (12 yo), 2209 (14 yo), 2209 (14 yo), 2209 (11 yo), 2209 (12 yo), 2209 (15 yo)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_025.png" />
</li>
<li><img alt="2209 (12 yo), 2209 (8 yo), 2209 (6 yo), 2209 (14 yo), 2209 (11 yo), 2209 (12 yo), 2209 (12 yo), 2209 (8 yo), 2209 (11 yo), 2209 (10 yo), 2209 (9 yo), 2209 (9 yo), 2209 (6 yo), 2209 (13 yo), 2209 (8 yo)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_026.png" />
</li>
<li><img alt="2209 (13 yo)" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_mpl_trajectories_027.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Adding...                  severe | max
Adding...                 warning | max
Adding...                    mild | max

Dtypes:
Unnamed: 0                      Int64
study_no                       string
date                    datetime64...
abdominal_pain                boolean
abdominal_tenderness          boolean
                            ...
severe_bleed                  boolean
severe_organ                  boolean
severe                        boolean
warning                       boolean
mild                          boolean
Length: 428, dtype: object

Data Full:
        Unnamed: 0       study_no       date  abdominal_pain  abdominal_tenderness  abscess   age   aids   alt  ...  rur_urb  liver_abnormal  kidney_abnormal  severe_leak  severe_bleed  severe_organ  severe  warning   mild
409            409  01nva-003-... 2020-07-14           True           False            &lt;NA&gt;  16.0   &lt;NA&gt;  62.0  ...     &lt;NA&gt;          False            &lt;NA&gt;          False         False          True    True     True  False
410            410  01nva-003-... 2020-07-15           True            &lt;NA&gt;            &lt;NA&gt;  16.0   &lt;NA&gt;  &lt;NA&gt;  ...     &lt;NA&gt;          False            &lt;NA&gt;          False         False         False    True     True  False
411            411  01nva-003-... 2020-07-16           True            &lt;NA&gt;           False  16.0   &lt;NA&gt;  &lt;NA&gt;  ...     &lt;NA&gt;          False            &lt;NA&gt;          False         False         False    True     True  False
412            412  01nva-003-... 2020-07-17           True            &lt;NA&gt;            &lt;NA&gt;  16.0   &lt;NA&gt;  &lt;NA&gt;  ...     &lt;NA&gt;          False            &lt;NA&gt;          False         False         False    True     True  False
415            415  01nva-003-... 2020-07-28           True            True           False  17.0  False  17.0  ...     &lt;NA&gt;          False           False           True         False          True    True     True  False
...            ...            ...        ...            ...             ...             ...   ...    ...   ...  ...      ...            ...             ...            ...           ...           ...     ...      ...    ...
124836       33914         md-994 2003-07-21          False           False            &lt;NA&gt;  13.0   &lt;NA&gt;  &lt;NA&gt;  ...    Urban          False            &lt;NA&gt;          False         False          True    True    False  False
124846       33924         md-995 2003-07-22          False           False            &lt;NA&gt;   9.0   &lt;NA&gt;  &lt;NA&gt;  ...     &lt;NA&gt;          False            &lt;NA&gt;          False         False          True    True    False  False
124857       33935         md-996 2003-07-22          False           False            &lt;NA&gt;  10.0   &lt;NA&gt;  &lt;NA&gt;  ...    Urban          False            &lt;NA&gt;          False         False          True    True     True  False
124877       33955         md-998 2003-07-23          False           False            &lt;NA&gt;  13.0   &lt;NA&gt;  &lt;NA&gt;  ...     &lt;NA&gt;          False            &lt;NA&gt;          False         False          True    True     True  False
124888       33966         md-999 2003-07-23          False           False            &lt;NA&gt;  15.0   &lt;NA&gt;  &lt;NA&gt;  ...    Urban          False            &lt;NA&gt;          False         False          True    True     True  False

[19516 rows x 428 columns]

Data Agg:
               dsource   age  weight    plt  haematocrit_percent  body_temperature  gender       date  shock  severe  warning   mild
study_no
01nva-003-2008   01nva  16.0    72.0    8.0           54.0               37.075        1.0 2020-07-17   True    True     True  False
01nva-003-2009   01nva  17.0    44.0    8.0        47.3333                 37.0        0.0 2020-07-30   True    True     True  False
01nva-003-2012   01nva  17.0    48.0    9.0          49.15              37.1875        0.0 2020-08-15   True    True     True  False
01nva-003-2024   01nva  16.0   114.0    9.0           49.1              37.1167        1.0 2020-10-09   True    True     True  False
01nva-003-2028   01nva  18.0    82.0   18.0        42.9714                37.15        0.0 2020-11-07   True    True     True  False
...                ...   ...     ...    ...            ...                  ...        ...        ...    ...     ...      ...    ...
md-994              md  13.0    53.0   88.0           42.0                 40.0        0.0 2003-08-27  False    True    False   True
md-995              md   9.0    27.5  132.0           37.8                 39.0        0.0 2003-08-27  False    True    False   True
md-996              md  10.0    33.0   75.0           43.0                 39.9        0.0 2003-07-24  False    True     True  False
md-998              md  13.0    44.0   94.0           41.5                 38.5        1.0 2003-08-29  False    True     True  False
md-999              md  15.0    49.0   56.0           40.5                 38.5        0.0 2003-08-29  False    True     True  False

[12884 rows x 12 columns]
severe     5029
warning    6809
mild       5609
dtype: int64

Data 01NVA:
               dsource   age  weight   plt  haematocrit_percent  body_temperature  gender       date  shock  severe  warning   mild
study_no
01nva-003-2008   01nva  16.0    72.0   8.0           54.0               37.075        1.0 2020-07-17   True    True     True  False
01nva-003-2009   01nva  17.0    44.0   8.0        47.3333                 37.0        0.0 2020-07-30   True    True     True  False
01nva-003-2012   01nva  17.0    48.0   9.0          49.15              37.1875        0.0 2020-08-15   True    True     True  False
01nva-003-2024   01nva  16.0   114.0   9.0           49.1              37.1167        1.0 2020-10-09   True    True     True  False
01nva-003-2028   01nva  18.0    82.0  18.0        42.9714                37.15        0.0 2020-11-07   True    True     True  False
01nva-003-2033   01nva  17.0    50.0  19.0        46.5333              37.0333        0.0 2021-01-14   True    True     True  False
01nva-003-2108   01nva  17.0    62.0  12.0           43.0              37.2333        0.0 2020-10-11   True    True     True  False
01nva-003-2110   01nva  17.0    49.0   8.0           53.4                37.22        1.0 2020-11-08   True    True     True  False
01nva-003-2168   01nva  16.0    62.0  20.0           42.6              37.0944        0.0 2020-08-16   &lt;NA&gt;    True    False   True
01nva-003-2171   01nva  17.0    58.0  26.0           45.9               37.225        0.0 2020-08-22   &lt;NA&gt;    True    False   True
01nva-003-2175   01nva  16.0    61.0  36.5           41.8                37.25        1.0 2020-09-08   &lt;NA&gt;    True     True  False
01nva-003-2192   01nva  16.0    53.0  29.0           47.1              37.7792        0.0 2020-12-26   &lt;NA&gt;    True    False   True
01nva-003-2201   01nva   9.0    39.0  33.0           45.6              37.1611        1.0 2020-06-07   True    True     True  False
01nva-003-2202   01nva  13.0    73.0   6.0        46.2333              37.2875        0.0 2020-06-19   True    True     True  False
01nva-003-2203   01nva  10.0    23.8  33.0        47.1333              37.2708        0.0 2020-06-19   True    True     True  False
01nva-003-2204   01nva  13.0    78.0  19.0        46.8333              37.2333        1.0 2020-06-27   True    True     True  False
01nva-003-2205   01nva  13.0    33.0   9.0           40.9               37.205        0.0 2020-07-05   True    True    False  False
01nva-003-2206   01nva  12.0    40.0  14.0        46.9429                37.45        1.0 2020-07-11   True    True     True  False
01nva-003-2208   01nva  12.0    47.0  58.0        52.8667              37.2417        1.0 2020-07-22   True    True     True  False
01nva-003-2209   01nva  10.0    31.0  30.5           35.3              36.9611        0.0 2020-08-02   True    True     True  False
01nva-003-2210   01nva  10.0    50.0  11.5          41.86                37.25        1.0 2020-08-06   True    True     True  False
01nva-003-2211   01nva   9.0    22.0  30.0           51.1               37.075        0.0 2020-08-09   &lt;NA&gt;   False     True  False
01nva-003-2212   01nva  11.0    47.7  13.5         40.955                 37.3        0.0 2020-08-21   True    True     True  False
01nva-003-2213   01nva  11.0    56.0  16.0          46.42              37.2542        1.0 2020-08-25   True    True     True  False
01nva-003-2214   01nva  12.0    30.0  39.0          46.35               37.325        1.0 2020-08-27   True    True     True  False
01nva-003-2216   01nva  14.0    44.0  22.0           48.2               37.205        0.0 2020-09-11   &lt;NA&gt;    True     True  False
01nva-003-2217   01nva  14.0    45.0  10.0           42.0                37.33        0.0 2020-09-13   &lt;NA&gt;    True     True  False
01nva-003-2218   01nva  11.0    28.0  29.0           47.6              37.2556        0.0 2020-09-16   True    True     True  False
01nva-003-2219   01nva  12.0    38.3  19.0           44.4                 37.2        1.0 2020-09-20   &lt;NA&gt;   False     True  False
01nva-003-2220   01nva  15.0    66.4  10.0           53.2              37.0833        1.0 2020-09-27   &lt;NA&gt;    True     True   True
01nva-003-2221   01nva  12.0    43.7  27.0           51.1              37.2833        0.0 2020-09-30   &lt;NA&gt;    True     True  False
01nva-003-2222   01nva   8.0    40.7  23.0          67.05              37.1733        1.0 2020-10-05   True    True     True  False
01nva-003-2223   01nva   6.0    20.0  18.0           45.7              37.0875        0.0 2020-10-11   &lt;NA&gt;   False     True  False
01nva-003-2224   01nva  14.0    83.0  26.0           49.8              37.4167        1.0 2020-10-10   &lt;NA&gt;   False     True   True
01nva-003-2225   01nva  11.0    48.0  22.0           43.3              37.4083        0.0 2020-10-12   True    True     True  False
01nva-003-2226   01nva  12.0    25.4  46.0          43.25              37.0833        1.0 2020-10-18   &lt;NA&gt;   False     True  False
01nva-003-2227   01nva  12.0    45.0  24.0           46.2                 37.4        1.0 2020-10-26   &lt;NA&gt;    True     True  False
01nva-003-2228   01nva   8.0    32.3  22.0          47.65                 37.3        0.0 2020-10-25   True    True     True  False
01nva-003-2229   01nva  11.0    38.0  38.0           44.4                37.25        0.0 2020-11-04   &lt;NA&gt;   False     True  False
01nva-003-2230   01nva  10.0    43.8  24.0           47.0                 37.4        1.0 2020-11-25   &lt;NA&gt;   False     True  False
01nva-003-2231   01nva   9.0    42.2  21.0           44.9              37.2083        1.0 2020-12-05   &lt;NA&gt;    True     True  False
01nva-003-2232   01nva   9.0    28.0  18.0           46.7              37.1875        1.0 2020-12-19   True    True     True  False
01nva-003-2233   01nva   6.0    22.0  37.0           51.3                37.25        1.0 2020-12-30   &lt;NA&gt;    True     True  False
01nva-003-2234   01nva  13.0    61.0  17.5          52.15               37.375        1.0 2021-01-08   &lt;NA&gt;    True     True  False
01nva-003-2235   01nva   8.0    21.0  18.0           43.1              37.3333        0.0 2021-01-17   &lt;NA&gt;   False     True  False
01nva-003-2236   01nva  13.0    34.0  17.5          42.15                 37.5        0.0 2021-01-19   &lt;NA&gt;   False     True  False

Model:
Autoencoder(
  (encoder): Sequential(
    (0): Linear(in_features=5, out_features=3, bias=True)
    (1): Sigmoid()
    (2): Linear(in_features=3, out_features=2, bias=True)
    (3): Sigmoid()
  )
  (decoder): Sequential(
    (0): Linear(in_features=2, out_features=3, bias=True)
    (1): Sigmoid()
    (2): Linear(in_features=3, out_features=5, bias=True)
    (3): Sigmoid()
  )
)

Scaler:
MinMaxScaler()

Data:
               dsource   age  weight    plt  haematocrit_percent  body_temperature  gender       date  shock  severe  warning   mild       x       y
study_no
01nva-003-2008   01nva  16.0    72.0    8.0           54.0               37.075        1.0 2020-07-17   True    True     True  False  0.1512  0.7534
01nva-003-2009   01nva  17.0    44.0    8.0        47.3333                 37.0        0.0 2020-07-30   True    True     True  False  0.2637  0.7461
01nva-003-2012   01nva  17.0    48.0    9.0          49.15              37.1875        0.0 2020-08-15   True    True     True  False  0.2355  0.7499
01nva-003-2024   01nva  16.0   114.0    9.0           49.1              37.1167        1.0 2020-10-09   True    True     True  False  0.0770  0.7300
01nva-003-2028   01nva  18.0    82.0   18.0        42.9714                37.15        0.0 2020-11-07   True    True     True  False  0.1061  0.7033
...                ...   ...     ...    ...            ...                  ...        ...        ...    ...     ...      ...    ...     ...     ...
md-994              md  13.0    53.0   88.0           42.0                 40.0        0.0 2003-08-27  False    True    False   True  0.2153  0.5973
md-995              md   9.0    27.5  132.0           37.8                 39.0        0.0 2003-08-27  False    True    False   True  0.4943  0.5385
md-996              md  10.0    33.0   75.0           43.0                 39.9        0.0 2003-07-24  False    True     True  False  0.4532  0.6385
md-998              md  13.0    44.0   94.0           41.5                 38.5        1.0 2003-08-29  False    True     True  False  0.2835  0.5919
md-999              md  15.0    49.0   56.0           40.5                 38.5        0.0 2003-08-29  False    True     True  False  0.2306  0.6417

[12884 rows x 14 columns]

Patients:
151
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="c1"># Library</span>
 <span class="kn">import</span> <span class="nn">pickle</span>
 <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
 <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
 <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>

 <span class="c1"># Specific</span>
 <span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
 <span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
 <span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KDTree</span>
 <span class="kn">from</span> <span class="nn">tableone</span> <span class="kn">import</span> <span class="n">TableOne</span>

 <span class="c1"># Specific</span>
 <span class="kn">from</span> <span class="nn">pkgname.core.AE.autoencoder</span> <span class="kn">import</span> <span class="n">get_device</span><span class="p">,</span> <span class="n">set_seed</span>
 <span class="kn">from</span> <span class="nn">pkgname.utils.data_loader</span> <span class="kn">import</span> <span class="n">load_dengue</span><span class="p">,</span> <span class="n">IQR_rule</span>
 <span class="kn">from</span> <span class="nn">pkgname.utils.plot_utils</span> <span class="kn">import</span>  <span class="n">format_table_bootstrap</span>
 <span class="kn">from</span> <span class="nn">definitions</span> <span class="kn">import</span> <span class="n">ROOT_DIR</span>

 <span class="c1"># Local</span>
 <span class="kn">import</span> <span class="nn">_utils</span>



 <span class="c1"># ------------------------------</span>
 <span class="c1"># Constants</span>
 <span class="c1"># ------------------------------</span>
 <span class="c1"># Load constants</span>
 <span class="n">features</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">features</span>
 <span class="n">others</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">others</span>
 <span class="n">mappings</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">mappings</span>
 <span class="n">aggregation</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">aggregation</span>
 <span class="n">cmaps</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">cmaps</span>

 <span class="c1"># Define outcomes</span>
 <span class="n">outcomes</span> <span class="o">=</span> <span class="p">[</span>
     <span class="s2">&quot;severe&quot;</span><span class="p">,</span>
     <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
     <span class="s2">&quot;mild&quot;</span><span class="p">]</span>

 <span class="c1"># Ensure all outcomes are in aggregation</span>
 <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">:</span>
     <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aggregation</span><span class="p">:</span>
         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adding... </span><span class="si">%23s</span><span class="s2"> | max&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>
         <span class="n">aggregation</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;max&#39;</span>

 <span class="c1"># ------------------------------</span>
 <span class="c1"># Load data</span>
 <span class="c1"># ------------------------------</span>
 <span class="c1"># Load data</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>

 <span class="c1"># Liver abnormal</span>
 <span class="n">data</span><span class="p">[</span><span class="s1">&#39;liver_abnormal&#39;</span><span class="p">]</span> <span class="o">=</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">liver_acute</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">liver_involved</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">liver_failure</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">liver_severe</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">jaundice</span>

 <span class="c1"># Kidney abnormal</span>
 <span class="n">data</span><span class="p">[</span><span class="s1">&#39;kidney_abnormal&#39;</span><span class="p">]</span> <span class="o">=</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">skidney</span>

 <span class="c1"># Create features</span>
 <span class="n">data</span><span class="p">[</span><span class="s1">&#39;severe_leak&#39;</span><span class="p">]</span> <span class="o">=</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">ascites</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">overload</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">oedema_pulmonary</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">respiratory_distress</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">oedema</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">pleural_effusion</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">effusion</span>

 <span class="c1"># Bleeding</span>
 <span class="n">data</span><span class="p">[</span><span class="s1">&#39;severe_bleed&#39;</span><span class="p">]</span> <span class="o">=</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">bleeding_gi</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">bleeding_urine</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">bleeding_mucosal</span>

 <span class="c1"># Organ impairment</span>
 <span class="n">data</span><span class="p">[</span><span class="s1">&#39;severe_organ&#39;</span><span class="p">]</span> <span class="o">=</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">cns_abnormal</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">neurology</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">liver_abnormal</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">kidney_abnormal</span> <span class="o">|</span> \
     <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ast</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">|</span> \
     <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">alt</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">)</span>

 <span class="c1"># Category: severe</span>
 <span class="n">data</span><span class="p">[</span><span class="s1">&#39;severe&#39;</span><span class="p">]</span> <span class="o">=</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">severe_leak</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">severe_bleed</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">severe_organ</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">shock</span>

 <span class="c1"># Category: warning WHO</span>
 <span class="n">data</span><span class="p">[</span><span class="s1">&#39;warning&#39;</span><span class="p">]</span> <span class="o">=</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">abdominal_pain</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">abdominal_tenderness</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">vomiting</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">ascites</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">pleural_effusion</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">bleeding_mucosal</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">restlessness</span> <span class="o">|</span> \
     <span class="n">data</span><span class="o">.</span><span class="n">lethargy</span> <span class="o">|</span> \
     <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">liver_palpation_size</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>

 <span class="c1"># Category: mild</span>
 <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mild&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">severe</span> <span class="o">|</span> <span class="n">data</span><span class="o">.</span><span class="n">warning</span><span class="p">)</span>

 <span class="c1"># Fill empty values (be careful!)</span>
 <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">:</span>
     <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

 <span class="c1"># Raw after very basic cleaning</span>
 <span class="n">raw</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

 <span class="c1"># Filter data (age, iqr, ...)</span>
 <span class="c1"># .. note: Although previously we were filtering only</span>
 <span class="c1">#          for adults, there is an interesting patient</span>
 <span class="c1">#          (01nva-003-2164) who is 19 years old.</span>
 <span class="c1">#</span>
 <span class="c1"># .. note: Platelets has a very clear outlier 50000</span>
 <span class="c1">#          which influences the quartile selection</span>
 <span class="c1">#          in the quartile range rule (IQR)</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">)]</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">plt</span> <span class="o">&lt;</span> <span class="mi">50000</span><span class="p">]</span> <span class="c1"># extreme outlier</span>

 <span class="c1"># Filter outliers</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">IQR_rule</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span>
     <span class="s1">&#39;plt&#39;</span><span class="p">,</span>
     <span class="c1">#&#39;haematocrit_percent&#39;,</span>
     <span class="c1">#&#39;body_temperature&#39;</span>
 <span class="p">])</span>

 <span class="c1"># Convert dtypes</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">convert_dtypes</span><span class="p">()</span>

 <span class="c1"># Rename</span>
 <span class="c1"># .. note: Done after convert_dtypes so that</span>
 <span class="c1">#          it remains 0 or 1, otherwise it will</span>
 <span class="c1">#          be transformed to boolean feature.</span>
 <span class="c1">#          (its ok too).</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">mappings</span><span class="p">)</span>

 <span class="c1"># Show dtypes</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Dtypes:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>

 <span class="c1"># ------------------------------</span>
 <span class="c1"># Aggregate to worse combo</span>
 <span class="c1"># ------------------------------</span>
 <span class="c1"># Get worst state for patient</span>
 <span class="n">data_w</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
     <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;study_no&quot;</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> \
     <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggregation</span><span class="p">)</span> \
     <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">features</span><span class="p">)</span>

 <span class="c1"># Get full data</span>
 <span class="n">data_f</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
     <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">features</span><span class="p">)</span>

 <span class="c1"># Show data</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data Full:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">data_f</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data Agg:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">data_w</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">data_w</span><span class="p">[</span><span class="n">outcomes</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data 01NVA:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">data_w</span><span class="p">[</span><span class="n">data_w</span><span class="o">.</span><span class="n">dsource</span> <span class="o">==</span> <span class="s1">&#39;01nva&#39;</span><span class="p">])</span>

 <span class="c1"># ------------------------------</span>
 <span class="c1"># Load Model</span>
 <span class="c1"># ------------------------------</span>
 <span class="c1"># Load model</span>
 <span class="n">model</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">load_model</span><span class="p">()</span>

 <span class="c1"># Show</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Model:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

 <span class="c1"># ------------------------------</span>
 <span class="c1"># Projections</span>
 <span class="c1"># ------------------------------</span>
 <span class="c1"># .. note: The scaling method should have also</span>
 <span class="c1">#          been saved when training the model.</span>
 <span class="c1"># Scaler</span>
 <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_f</span><span class="p">[</span><span class="n">features</span><span class="p">])</span>

 <span class="c1"># Include encoded in aggregated</span>
 <span class="n">data_w</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode_inputs</span><span class="p">(</span> \
     <span class="n">DataLoader</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data_w</span><span class="p">[</span><span class="n">features</span><span class="p">]),</span>
          <span class="mi">16</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

 <span class="c1"># Include encoded in full (filtered)</span>
 <span class="n">data_f</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode_inputs</span><span class="p">(</span> \
     <span class="n">DataLoader</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data_f</span><span class="p">[</span><span class="n">features</span><span class="p">]),</span>
          <span class="mi">16</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

 <span class="c1"># Show</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Scaler:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">scaler</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">data_w</span><span class="p">)</span>


 <span class="c1"># ------------------------------</span>
 <span class="c1"># Visualization</span>
 <span class="c1"># ------------------------------</span>
 <span class="c1"># Libraries</span>
 <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

 <span class="c1"># Specific</span>
 <span class="kn">from</span> <span class="nn">_utils</span> <span class="kn">import</span> <span class="n">kde_mpl_plot</span>
 <span class="kn">from</span> <span class="nn">_utils</span> <span class="kn">import</span> <span class="n">kde_mpl_compute</span>
 <span class="kn">from</span> <span class="nn">_utils</span> <span class="kn">import</span> <span class="n">kde_mpl</span>

 <span class="c1"># ------------------------------------</span>
 <span class="c1"># Show interesting outcomes (contours)</span>
 <span class="c1"># ------------------------------------</span>
 <span class="c1"># Figure with kdes</span>
 <span class="n">f1</span><span class="p">,</span> <span class="n">axes1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
     <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

 <span class="c1"># Loop</span>
 <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
     <span class="c1"># Select dataset</span>
     <span class="n">aux</span> <span class="o">=</span> <span class="n">data_w</span><span class="p">[</span><span class="n">data_w</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
     <span class="c1"># Plot kde</span>
     <span class="n">kde_mpl</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">aux</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes1</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
         <span class="n">contour</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmaps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;Reds&#39;</span><span class="p">),</span>
         <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">data_w</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data_w</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
         <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="n">data_w</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data_w</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
     <span class="c1"># Configure</span>
     <span class="n">axes1</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">aux</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

 <span class="c1"># Plot aggregated (data_w)</span>
 <span class="n">aux</span> <span class="o">=</span> <span class="n">data_w</span><span class="p">[</span><span class="n">data_w</span><span class="o">.</span><span class="n">dsource</span> <span class="o">==</span> <span class="s1">&#39;01nva&#39;</span><span class="p">]</span>
 <span class="n">axes1</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">aux</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
     <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
     <span class="n">c</span><span class="o">=</span><span class="n">aux</span><span class="o">.</span><span class="n">shock</span> \
         <span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s1">&#39;r&#39;</span><span class="p">})</span> \
         <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>

 <span class="c1"># Plot daily (data_f)</span>
 <span class="n">aux</span> <span class="o">=</span> <span class="n">data_f</span><span class="p">[</span><span class="n">data_f</span><span class="o">.</span><span class="n">dsource</span> <span class="o">==</span> <span class="s1">&#39;01nva&#39;</span><span class="p">]</span>
 <span class="n">axes1</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">aux</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
     <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
     <span class="n">c</span><span class="o">=</span><span class="n">aux</span><span class="o">.</span><span class="n">event_shock</span> \
         <span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s1">&#39;r&#39;</span><span class="p">})</span> \
         <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>

 <span class="c1"># Order by study_no and day_from_admission</span>
 <span class="n">aux</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span> \
     <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;study_no&#39;</span><span class="p">,</span> <span class="s1">&#39;day_from_admission&#39;</span><span class="p">])</span>

 <span class="c1"># Plot trajectories</span>
 <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">g</span> <span class="ow">in</span> <span class="n">aux</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;study_no&#39;</span><span class="p">):</span>
     <span class="n">axes1</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
     <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">day_from_admission</span><span class="p">):</span>
         <span class="n">axes1</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

 <span class="c1"># Configure</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>



 <span class="c1"># -------------------------------------</span>
 <span class="c1"># Individual trajectories</span>
 <span class="c1"># -------------------------------------</span>
 <span class="c1"># .. note: Note that the scaling method before considers</span>
 <span class="c1">#          only patients under 18. Thus, wen testing patients</span>
 <span class="c1">#          over 18 they are pushed to the right hand side.</span>
 <span class="c1">#          Thus, we are min max scaling with all ages although</span>
 <span class="c1">#          this is not ideal if algorithm was trained with &lt;18.</span>
 <span class="c1"># Scaler</span>
 <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_f</span><span class="p">[</span><span class="n">features</span><span class="p">])</span>
 <span class="c1">#scaler = MinMaxScaler().fit(raw[features])</span>

 <span class="c1"># Convert dtypes</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">convert_dtypes</span><span class="p">()</span>
 <span class="c1"># Select all 01nva data and clean</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[</span><span class="n">raw</span><span class="o">.</span><span class="n">dsource</span> <span class="o">==</span> <span class="s1">&#39;01nva&#39;</span><span class="p">]</span> \
     <span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
     <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">features</span><span class="p">)</span> \
     <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;study_no&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;day_from_admission&#39;</span><span class="p">])</span>

 <span class="c1"># Include encoded in full (filtered)</span>
 <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode_inputs</span><span class="p">(</span> \
     <span class="n">DataLoader</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">features</span><span class="p">]),</span>
          <span class="mi">16</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

 <span class="c1"># Compute KDE (children)</span>
 <span class="n">aux</span> <span class="o">=</span> <span class="n">data_w</span><span class="p">[</span><span class="n">data_w</span><span class="o">.</span><span class="n">severe</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
 <span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">,</span> <span class="n">Zgrid</span> <span class="o">=</span> <span class="n">kde_mpl_compute</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">aux</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
     <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">data_w</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data_w</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
     <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="n">data_w</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data_w</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>

 <span class="sd">&quot;&quot;&quot;</span>
<span class="sd"> # Compute KD2 (all)</span>
<span class="sd"> # Get worst state for patient</span>
<span class="sd"> scl = MinMaxScaler().fit(raw[features])</span>
<span class="sd"> aux = raw.copy(deep=True)</span>
<span class="sd"> aux_w = aux.copy(deep=True) \</span>
<span class="sd">     .groupby(by=&quot;study_no&quot;, dropna=False) \</span>
<span class="sd">     .agg(aggregation) \</span>
<span class="sd">     .dropna(how=&#39;any&#39;, subset=features)</span>
<span class="sd"> # Include encoded in full (filtered)</span>
<span class="sd"> aux_w[[&#39;x&#39;, &#39;y&#39;]] = model.encode_inputs( \</span>
<span class="sd">     DataLoader(scl.transform(aux_w[features]),</span>
<span class="sd">          16, shuffle=False))</span>
<span class="sd"> aux = aux_w[aux_w.severe == 1]</span>
<span class="sd"> xgrid, ygrid, Zgrid = kde_mpl_compute(aux.x, aux.y,</span>
<span class="sd">     xlim=(aux_w.x.min(), aux_w.x.max()),</span>
<span class="sd">     ylim=(aux_w.y.min(), aux_w.y.max()))</span>
<span class="sd"> &quot;&quot;&quot;</span>
 <span class="c1"># Show</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Patients:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">study_no</span><span class="o">.</span><span class="n">nunique</span><span class="p">())</span>

 <span class="c1"># -------------------------</span>
 <span class="c1"># Plot interesting patients</span>
 <span class="c1"># -------------------------</span>
 <span class="c1"># Lets define the patients</span>
 <span class="n">patients</span> <span class="o">=</span> <span class="p">[</span>
     <span class="mi">1105</span><span class="p">,</span>
     <span class="mi">2012</span><span class="p">,</span> <span class="c1"># 2 shocks</span>
     <span class="mi">2013</span><span class="p">,</span>
     <span class="mi">2026</span><span class="p">,</span> <span class="c1"># 3 shocks</span>
     <span class="mi">2103</span><span class="p">,</span> <span class="c1"># 2 shocks</span>
     <span class="mi">2104</span><span class="p">,</span>
     <span class="mi">2110</span><span class="p">,</span>
     <span class="mi">2168</span><span class="p">,</span>
     <span class="mi">2203</span><span class="p">,</span>
     <span class="mi">2205</span><span class="p">,</span>
     <span class="mi">2206</span><span class="p">,</span>
     <span class="mi">2205</span><span class="p">,</span>
     <span class="mi">2217</span><span class="p">,</span>
     <span class="mi">2222</span><span class="p">,</span>
     <span class="mi">2207</span><span class="p">,</span> <span class="c1"># 3 shocks</span>
     <span class="mi">2209</span><span class="p">,</span> <span class="c1"># 2 shocks</span>
 <span class="p">]</span>

 <span class="c1"># Plot graph for each patient</span>
 <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patients</span><span class="p">:</span>
     <span class="c1"># Get data</span>
     <span class="n">aux</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">study_no</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))]</span>

     <span class="k">if</span> <span class="n">aux</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="k">continue</span>

     <span class="c1"># Create figure</span>
     <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

     <span class="c1"># Plot KDE (data aggregated)</span>
     <span class="n">kde_mpl_plot</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">,</span> <span class="n">Zgrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
         <span class="n">contour</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">)</span>

     <span class="c1"># Plot evolution (line + markers)</span>
     <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">aux</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
         <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
     <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Patient </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1"> years)&#39;</span> <span class="o">%</span> \
         <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

     <span class="c1"># Plot numbers</span>
     <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">aux</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">aux</span><span class="o">.</span><span class="n">day_from_admission</span><span class="p">):</span>
         <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

     <span class="c1"># Plot shock</span>
     <span class="k">if</span> <span class="n">aux</span><span class="o">.</span><span class="n">event_shock</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
         <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
             <span class="n">aux</span><span class="p">[</span><span class="n">aux</span><span class="o">.</span><span class="n">event_shock</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
             <span class="n">aux</span><span class="p">[</span><span class="n">aux</span><span class="o">.</span><span class="n">event_shock</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)]</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
             <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
             <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

     <span class="c1"># Hide the right and top spines</span>
     <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
     <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

     <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

     <span class="c1"># Show</span>
     <span class="c1">#print(aux[features + others + [&#39;shock&#39;, &#39;event_shock&#39;]])</span>


 <span class="c1"># -------------------------</span>
 <span class="c1"># Plot ALL patients</span>
 <span class="c1"># -------------------------</span>
 <span class="c1"># Filter more than length n</span>
 <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">study_no</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
 <span class="n">aux</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">study_no</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)])]</span>

 <span class="c1"># Create groups</span>
 <span class="n">groups</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;study_no&#39;</span><span class="p">)</span>

 <span class="c1"># For each patient</span>
 <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">g</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>

     <span class="k">if</span> <span class="n">c</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="c1"># Tight previous figure</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
         <span class="c1"># Create figure</span>
         <span class="n">f2</span><span class="p">,</span> <span class="n">axes2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
             <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

     <span class="c1">#if c &gt; len(axes2.flat) - 1:</span>
     <span class="c1">#    break</span>
     <span class="c1"># Get axes</span>
     <span class="n">ax</span> <span class="o">=</span> <span class="n">axes2</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">c</span> <span class="o">%</span> <span class="mi">15</span><span class="p">]</span>

     <span class="c1"># Plot KDE (data aggregated)</span>
     <span class="n">kde_mpl_plot</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">,</span> <span class="n">Zgrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
             <span class="n">contour</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">)</span>

     <span class="c1"># Plot line and markers</span>
     <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
         <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
     <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
     <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1"> yo)&#39;</span> <span class="o">%</span> \
         <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

     <span class="c1"># Highlight shocks</span>
     <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">event_shock</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
         <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
             <span class="n">g</span><span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">event_shock</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
             <span class="n">g</span><span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">event_shock</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)]</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
             <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
             <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

     <span class="c1"># Plot numbers</span>
     <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">day_from_admission</span><span class="p">):</span>
         <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
     <span class="c1"># Show legend</span>
     <span class="c1">#ax.legend(loc=&quot;lower right&quot;)</span>
     <span class="c1"># Hide the right and top spines</span>
     <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
     <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>



 <span class="c1"># Configure</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

 <span class="c1"># Show</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  27.816 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-visualization-plot-mpl-trajectories-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/491bcb9a93980ec83e06a772ed63aaf0/plot_mpl_trajectories.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_mpl_trajectories.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/d7479b79932a0ad71ecc3e9257ad0917/plot_mpl_trajectories.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_mpl_trajectories.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="plot_sns_categories_01.html" class="btn btn-neutral float-right" title="Seaborn (incomplete!)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="plot_mpl_outcomes_nmb.html" class="btn btn-neutral float-left" title="Outcomes (numbers)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Oliver Stiff.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>